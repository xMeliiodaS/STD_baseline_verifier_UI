<Window
    x:Class="AT_baseline_verifier.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="AT Baseline Verifier"
    Height="575"
    Width="690"
    MinWidth="690"
    MinHeight="575"
    Background="#1E1E1E"
    WindowStartupLocation="CenterScreen"
    Style="{StaticResource MaterialDesignWindow}"
    AllowDrop="True"
    Drop="Window_Drop"
    DragOver="Window_DragOver">

    <Grid
        Margin="20,20,20,5">

        <Grid.LayoutTransform>
            <ScaleTransform
                ScaleX="1.15"
                ScaleY="1.15" />
        </Grid.LayoutTransform>

        <Grid.RowDefinitions>
            <RowDefinition
                Height="Auto" />
            <RowDefinition
                Height="*" />
            <RowDefinition
                Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock
            Text="STD Baseline Verifier"
            Foreground="White"
            HorizontalAlignment="Center"
            FontSize="26"
            FontWeight="Bold"
            Margin="0,0,0,20" />


        <!-- Main Content -->
        <Border
            Grid.Row="1"
            Background="#2D2D30"
            CornerRadius="12"
            Padding="20"
            Margin="0,0,0,59"
            Grid.RowSpan="2">

            <StackPanel>

                <!-- File Selector Button -->
                <Button
                    x:Name="SelectSTDButton"
                    Command="{Binding SelectFileCommand}"
                    Style="{StaticResource PurpleButton}"
                    Margin="0,0,0,4"
                    Cursor="Hand">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition
                                Width="Auto" />
                            <ColumnDefinition
                                Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Text="ðŸ“‚"
                            FontSize="18"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center" />

                        <TextBlock
                            Grid.Column="1"
                            Text="Select STD (Excel)"
                            TextWrapping="Wrap"
                            VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Drag & Drop Hint -->
                <TextBlock
                    Text="Or drag and drop an Excel file here"
                    Foreground="LightGray"
                    FontStyle="Italic"
                    FontSize="12"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,10" />

                <!-- Selected File Label -->
                <TextBlock
                    x:Name="SelectedFileLabel"
                    HorizontalAlignment="Center"
                    Text="{Binding SelectedFileName}"
                    Foreground="LightGray"
                    FontSize="14"
                    TextWrapping="Wrap"
                    Margin="0,10,0,0" />

                <!-- STD Name with Placeholder -->
                <Grid
                    Margin="0,3,0,12"
                    MaxWidth="300">
                    <TextBox
                        x:Name="STDNameInput"
                        Background="#3C3C3C"
                        Foreground="White"
                        BorderBrush="#555"
                        Padding="8"
                        FontSize="14"
                        HorizontalContentAlignment="Center"
                        Text="{Binding StdName, UpdateSourceTrigger=PropertyChanged}"
                        TextChanged="STDNameInput_TextChanged" />
                    <TextBlock
                        x:Name="STDPlaceholder"
                        Text="STD Name"
                        HorizontalAlignment="Center"
                        Foreground="Gray"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        IsHitTestVisible="False" />
                </Grid>

                <!-- Iteration Path + Current V&V Version side by side -->
                <Grid
                    Margin="0,3,0,28"
                    MaxWidth="430">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="*" />
                        <ColumnDefinition
                            Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Iteration Path -->
                    <Grid
                        Grid.Column="0"
                        Margin="0,0,5,0"
                        MaxWidth="200">
                        <TextBox
                            x:Name="IterationPathInput"
                            Background="#3C3C3C"
                            Foreground="White"
                            BorderBrush="#555"
                            Padding="8"
                            FontSize="14"
                            HorizontalContentAlignment="Center"
                            Text="{Binding IterationPath, UpdateSourceTrigger=PropertyChanged}"
                            TextChanged="IterationPathInput_TextChanged" />
                        <TextBlock
                            x:Name="IterationPathPlaceholder"
                            Text="Iteration Path"
                            HorizontalAlignment="Center"
                            Foreground="Gray"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center"
                            IsHitTestVisible="False" />
                    </Grid>

                    <!-- Current V&V Version -->
                    <Grid
                        Grid.Column="1"
                        Margin="0,0,0,0"
                        MaxWidth="200">
                        <TextBox
                            x:Name="VVVersionInput"
                            Background="#3C3C3C"
                            Foreground="White"
                            BorderBrush="#555"
                            Padding="8"
                            FontSize="14"
                            HorizontalContentAlignment="Center"
                            Text="{Binding VvVersion, UpdateSourceTrigger=PropertyChanged}"
                            TextChanged="VVVersionInput_TextChanged" />
                        <TextBlock
                            x:Name="VVVersionPlaceholder"
                            Text="Current VV Version"
                            HorizontalAlignment="Center"
                            Foreground="Gray"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center"
                            IsHitTestVisible="False" />
                    </Grid>
                </Grid>

                <!-- ACTION BUTTONS -->
                <Grid
                    Margin="0,0,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition
                            Height="Auto" />
                        <RowDefinition
                            Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Run Bug Verification Button -->
                    <Button
                        x:Name="RunAutomationButton"
                        Grid.Row="0"
                        Command="{Binding RunAutomationCommand}"
                        Style="{StaticResource GreenButton}"
                        MaxWidth="350"
                        Cursor="Hand"
                        Margin="0,0,0,6"
                        ToolTipService.InitialShowDelay="500"
                        ToolTipService.BetweenShowDelay="0">
                        <Button.ToolTip>
                            <ToolTip Style="{StaticResource CustomToolTip}">
                                <TextBlock TextWrapping="Wrap">
                                    Runs full verification:
                                    <LineBreak/>
                                    â€¢ Extracts Failed Test Case IDs and Bugs from Excel
                                    <LineBreak/>
                                    â€¢ Checks each Bug in VSTS for correct STD ID, Iteration Path, and Last Reproduce In
                                    <LineBreak/>
                                    â€¢ Generates a summary Report of all findings
                                </TextBlock>
                            </ToolTip>
                        </Button.ToolTip>



                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="Auto" />
                                <ColumnDefinition
                                    Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                x:Name="RunIcon"
                                Text="â–¶"
                                FontSize="18"
                                Margin="0,0,8,0"
                                VerticalAlignment="Center" />

                            <TextBlock
                                x:Name="RunButtonText"
                                Grid.Column="1"
                                Text="Check STD Bugs in VSTS"
                                TextWrapping="Wrap"
                                VerticalAlignment="Center" />

                            <Ellipse
                                x:Name="ButtonSpinner"
                                Width="16"
                                Height="16"
                                Stroke="White"
                                StrokeThickness="2"
                                StrokeDashArray="2,2"
                                Visibility="Collapsed"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Margin="0,0,8,0">
                                <Ellipse.RenderTransform>
                                    <RotateTransform
                                        x:Name="ButtonSpinnerRotate"
                                        CenterX="8"
                                        CenterY="8" />
                                </Ellipse.RenderTransform>
                                <Ellipse.Triggers>
                                    <EventTrigger
                                        RoutedEvent="FrameworkElement.Loaded">
                                        <BeginStoryboard
                                            x:Name="ButtonSpinnerStoryboard">
                                            <Storyboard
                                                RepeatBehavior="Forever">
                                                <DoubleAnimation
                                                    Storyboard.TargetName="ButtonSpinnerRotate"
                                                    Storyboard.TargetProperty="Angle"
                                                    From="0"
                                                    To="360"
                                                    Duration="0:0:1" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Ellipse.Triggers>
                            </Ellipse>
                        </Grid>
                    </Button>
                    
                    
                    <!-- Open Last Report button -->
                    <Button
                        x:Name="OpenLastBugsReportButton"
                        Grid.Column="1"
                        Content="ðŸ“‘"
                        Style="{StaticResource BugReportButton}"
                        Cursor="Hand"
                        FontSize="16"
                        Width="32"
                        Height="31"
                        Margin="317,0,0,6"
                        VerticalAlignment="Center"
                        Command="{Binding OpenLastBugsReportCommand}"
                        ToolTipService.InitialShowDelay="0"
                        ToolTipService.BetweenShowDelay="0">

                        <Button.ToolTip>
                            <ToolTip Style="{StaticResource CustomToolTip}">
                                Open Last Report
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>

                    
                    <!-- Check Excel Violations -->
                    <Button
                        x:Name="RunViolationButton"
                        Grid.Row="1"
                        Command="{Binding RunViolationCheckCommand}"
                        Style="{StaticResource BlueButton}"
                        Cursor="Hand"
                        Margin="0,10,0,0">

                        <Button.ToolTip>
                            <ToolTip Style="{StaticResource CustomToolTip}">
                                <TextBlock TextWrapping="Wrap">
                                    Validates the STD Excel file and VSTS data:  
                                    <LineBreak/>
                                    â€¢ Checks that every Expected Result has a corresponding Test Result  
                                    <LineBreak/>
                                    â€¢ Verifies that any passed Test Result does not incorrectly have a Bug number  
                                    <LineBreak/>
                                    â€¢ Confirms that failed Test Results have an associated Bug number  
                                    <LineBreak/>
                                    â€¢ Generates a comprehensive HTML report summarizing all findings
                                </TextBlock>
                            </ToolTip>
                        </Button.ToolTip>



                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="Auto" />
                                <ColumnDefinition
                                    Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                x:Name="ViolationIcon"
                                Text=""
                                FontSize="15"
                                VerticalAlignment="Center" />

                            <TextBlock
                                x:Name="RunViolationButtonText"
                                Grid.Column="1"
                                Text="Validate STD Rules"
                                TextWrapping="Wrap"
                                VerticalAlignment="Center" />

                            <Ellipse
                                x:Name="ViolationButtonSpinner"
                                Width="16"
                                Height="16"
                                Stroke="White"
                                StrokeThickness="2"
                                StrokeDashArray="2,2"
                                Visibility="Collapsed"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Margin="0,0,8,0">
                                <Ellipse.RenderTransform>
                                    <RotateTransform
                                        x:Name="ViolationButtonSpinnerRotate"
                                        CenterX="8"
                                        CenterY="8" />
                                </Ellipse.RenderTransform>
                                <Ellipse.Triggers>
                                    <EventTrigger
                                        RoutedEvent="FrameworkElement.Loaded">
                                        <BeginStoryboard
                                            x:Name="ViolationSpinnerStoryboard">
                                            <Storyboard
                                                RepeatBehavior="Forever">
                                                <DoubleAnimation
                                                    Storyboard.TargetName="ViolationButtonSpinnerRotate"
                                                    Storyboard.TargetProperty="Angle"
                                                    From="0"
                                                    To="360"
                                                    Duration="0:0:1" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Ellipse.Triggers>
                            </Ellipse>
                        </Grid>
                    </Button>

                </Grid>

                <!-- Open Last Report button -->
                <Button
                        x:Name="OpenLastRulesReportButton"
                        Grid.Column="1"
                        Content="ðŸ“‘"
                        Style="{StaticResource RulesReportButton}"
                        Cursor="Hand"
                        FontSize="16"
                        Width="32"
                        Height="31"
                        Margin="197,-32,0,0"
                        VerticalAlignment="Center"
                        Command="{Binding OpenLastRulesReportCommand}"
                        ToolTipService.InitialShowDelay="0"
                        ToolTipService.BetweenShowDelay="0">

                    <Button.ToolTip>
                        <ToolTip Style="{StaticResource CustomToolTip}">
                            Open Last Report
                        </ToolTip>
                    </Button.ToolTip>
                </Button>

            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Border
            Grid.Row="2"
            Background="#2D2D30"
            Padding="8"
            CornerRadius="8"
            Margin="0,1,0,0">

            <StackPanel
                HorizontalAlignment="Center">
                <TextBlock
                    x:Name="StatusText"
                    Text="{Binding StatusMessage}"
                    Foreground="LightGray"
                    FontSize="12"
                    HorizontalAlignment="Center" />
                <TextBlock
                    Text="Developed by Bahaa"
                    Foreground="Gray"
                    FontSize="11"
                    FontStyle="Italic"
                    Margin="0,4,0,0"
                    HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

    </Grid>
</Window>
